振動制御クラス 
2012年1月25日 リインフォース・ラボ 上原昭宏

☆はじめに
これはiPhoneの連続振動出力のサンプルコードです。一定周期の連続した振動を出力します。
サンプルアプリは1画面アプリで、周期設定スライドバーと、振動開始/停止ボタン、があります。周期設定は0.01秒〜0.5秒の振動トリガ周期を調整できます。振動開始/停止ボタンは、振動の開始と停止を指示します。振動出力時は、ボタンラベルが赤色になります。
対応OSはiOS4/iOS5、ARC有効でビルドします。

☆アプリの注意点
この振動出力は、振動モータを内蔵した機種(iPhoneのみ、touchは内蔵してない)でのみ動作します。
振動モータを内蔵していない機種で実行した場合は、何も出力されません。(アラート音など、振動の代替動作は起きません。)

また、振動させるのに設定が必要です。
設定→サウンド→バイブレーション(3つめのグループの設定)がONでなければなりません。(一番上のサイレントのグループではないことに注意。この一番上のバイブレーションがOFFでも、3つめのグループのバイブレーションがONでありさえすれば、振動出力される。)
アプリ側からこの設定項目を検出することはできないようです。

☆ビルド方法
AudioToolbox.frameworkをリンクします。

☆使い方
vibrationControllerクラスを使ってください。

☆パラメータの設定
vibrationControllerのvibrate:メッセージの引数で周期を与えます。
0.4秒でブーという連続出力、0.42(もしくは0.27)秒で、ぶーぶーぶーと微妙な雰囲気の振動をします。
振動1つの周期は0.4秒程度です。ですから、この周期より若干短い周期でトリガすることで、連続した振動出力ができているのだと思います。トリガはNSTimerで周期的にかけているので、0.4秒の1/2周期、0.2秒設定でも、同じ振動パターンが得られます。ですがCPUの無駄遣いでしかないので、0.4前後の値設定を進めます。
iOS SDKは振動をトリガする機能しか、提供していません。(iOS5でカスタム振動パターン設定が機能追加されていますが、この機能はAPIで公開されていないようです。)

☆アプリの承認
振動マッサージアプリが複数アプリストアに登録されています。ですが、連続振動のものはありません。
ぶー(すこしの間)ぶー(すこしの間)という、間を入れた振動出力するアプリばかりのようです。また振動の強度制御をしているものはないのですが(APIで振動強度設定は提供されていない)、音や画像で強度を演出しているアプリはありました。
連続して振動を与えるアプリは、承認が得られないのかもしれません。
